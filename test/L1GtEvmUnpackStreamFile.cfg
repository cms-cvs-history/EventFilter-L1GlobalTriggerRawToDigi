//
// cfg file to unpack FED GT EVM record from a NewEventStreamFileReader source 
//

process EvmUnpackStreamFile = {

    // source file: FED GT EVM file, produced by NewEventStreamFileReader 

    source = NewEventStreamFileReader {
        untracked vstring fileNames = {
          'file:/afs/cern.ch/user/g/ghete/scratch0/CmsswTestFiles/GtEvmUnpackStreamFile_source.dat'
        }
    
        int32 max_event_size = 7000000
        int32 max_queue_depth = 5
    }

    // load and configure modules
    include "EventFilter/L1GlobalTriggerRawToDigi/data/l1GtEvmUnpack.cfi"

    // input tag 
    
    // NewEventStreamFile
    replace l1GtEvmUnpack.EvmGtInputTag = "source"

    // Active Boards Mask

    // no board masked (default)
    //replace l1GtEvmUnpack.ActiveBoardsMask = 0xFFFF
    
    // GTFE only in the record
    //replace l1GtEvmUnpack.ActiveBoardsMask = 0x0000

    // GTFE + TCS 
    //replace l1GtEvmUnpack.ActiveBoardsMask = 0x0001

    // GTFE + FDL 
    //replace l1GtEvmUnpack.ActiveBoardsMask = 0x0002
     
    // GTFE + TCS + FDL
    //replace l1GtEvmUnpack.ActiveBoardsMask = 0x0003

    // BxInEvent to be unpacked
    // all available BxInEvent (default)
    //replace l1GtEvmUnpack.UnpackBxInEvent = -1 

    // BxInEvent = 0 (L1A)
    //replace l1GtEvmUnpack.UnpackBxInEvent = 1 

    // 3 BxInEvent (F, 0, 1)  
    //replace l1GtEvmUnpack.UnpackBxInEvent = 3 

    // module list
    path p = { l1GtEvmUnpack}
    
    // exception treatment
    untracked PSet options = {
       // skip the event if processing modules produce
       // category "A", "B", or "C" exceptions
       //vstring SkipEvent = { "A", "B", "C" }
       //vstring FailModule = { "Q" }
       //... one vstring per action type
       
       untracked vstring IgnoreCompletely = { "NotFound" }
    }    

    // uncomment / comment messages with DEBUG mode to run in DEBUG mode
    service = MessageLogger {

      untracked vstring destinations =  {"GtEvmUnpackStreamFile"}
      untracked PSet GtEvmUnpackStreamFile = { 
          untracked string threshold = "DEBUG"                    // DEBUG mode 
          untracked PSet DEBUG = { untracked int32 limit = -1}    // DEBUG mode, all messages  
          //untracked PSet DEBUG = { untracked int32 limit = 10}  // DEBUG mode, max 10 mess.  
          untracked PSet INFO = { untracked int32 limit = -1}    
      }
      untracked vstring debugModules = { "l1GtEvmUnpack"}            // DEBUG mode 
      
    }
        
    module outputL1GtEvmUnpack = PoolOutputModule { 

        // keep only unpacked data in the ROOT file
        untracked vstring outputCommands = {
            "drop *",
            "keep *_l1GtEvmUnpack_*_*"
        }

        untracked string fileName = "GtEvmUnpackStreamFile_output.root" 
    }
    endpath outpath = { outputL1GtEvmUnpack }


}