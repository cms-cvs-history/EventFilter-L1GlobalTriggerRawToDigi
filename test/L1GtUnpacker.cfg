//
// cfg file to unpack FED GT DAQ record
//

process TestGtUnpacker = {

    // source file: FED GT DAQ file, produced by the packer, with GMT and GT records included 
    source = PoolSource {
        untracked vstring fileNames = {
            'file:/afs/cern.ch/user/g/ghete/scratch0/CmsswTestFiles/testGt_Unpacker_source.root'
        }
        untracked int32  maxEvents = 10
    }   

    // load and configure modules
	include "EventFilter/L1GlobalTriggerRawToDigi/data/l1GtUnpack.cfi"

    // input tag 
    
    // L1 GT Packer
    //replace l1GtUnpack.DaqGtInputTag = l1GtPack

    // packed GT DAQ record starting from dumped Spy data
    replace l1GtUnpack.DaqGtInputTag = vmeToRaw

    // Active Boards 
    // GTFE only in the record
    replace l1GtUnpack.ActiveBoardsMask = 0x0000

    // GTFE + FDL 
    //replace l1GtUnpack.ActiveBoardsMask = 0x0001
     
    // GTFE + GMT 
    //replace l1GtUnpack.ActiveBoardsMask = 0x0100

    // GTFE + FDL + GMT 
    //replace l1GtUnpack.ActiveBoardsMask = 0x0101

	// BxInEvent to be unpacked
    // all available BxInEvent
    //replace l1GtUnpack.UnpackBxInEvent = -1 

    // BxInEvent = 0 (L1A)
    replace l1GtUnpack.UnpackBxInEvent = 1 

    // 3 BxInEvent (F, 0, 1)  
    //replace l1GtUnpack.UnpackBxInEvent = 3 

    // module list
    path p = { l1GtUnpack}

    // uncomment / comment messages with DEBUG mode to run in DEBUG mode
    service = MessageLogger {

      untracked vstring destinations =  {"testGt_Unpacker"}
      untracked PSet testGt_Unpacker = { 
          untracked string threshold = "DEBUG"                  // DEBUG mode 
          untracked PSet DEBUG = { untracked int32 limit = -1}  // DEBUG mode, all messages  
//          untracked PSet DEBUG = { untracked int32 limit = 10}  // DEBUG mode, max 10 messages  
          untracked PSet INFO = { untracked int32 limit = -1}    
      }
      untracked vstring debugModules = { "l1GtUnpack"}          // DEBUG mode 
      
    }
        
    module outputL1GtUnpack = PoolOutputModule { 

        // keep only unpacked data in the ROOT file
        untracked vstring outputCommands = {
            "drop *",
            "keep *_l1GtUnpack_*_*"
        }

        untracked string fileName = "testGt_Unpacker_output.root" 
    }
    endpath outpath = { outputL1GtUnpack }

        
}