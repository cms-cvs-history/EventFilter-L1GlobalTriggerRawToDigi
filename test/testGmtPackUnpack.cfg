process GMTTEST = {

  untracked PSet maxEvents = {untracked int32 input = -1}

  service = MessageLogger {
     untracked vstring destinations = {"cout"}
     untracked PSet cout = { 
       untracked string threshold = "DEBUG"                  // DEBUG mode 
       untracked PSet DEBUG = { untracked int32 limit = -1}  // DEBUG mode, all messages  
     }
     untracked vstring debugModules = { "l1GtPack", "l1GtUnpack"}          // DEBUG mode 
  }

  source = L1MuGMTHWFileReader {

    untracked vstring fileNames = {"file:/afs/cern.ch/user/i/imikulec/big/CMSSW_1_6_0_DAQ3/src/L1Trigger/GlobalMuonTrigger/test/gmt_testfile.h4mu.dat"}

  }

  // L1 GT EventSetup
  include "L1TriggerConfig/L1GtConfigProducers/data/L1GtConfig.cff"

  // L1 GMT EventSetup
  include "L1TriggerConfig/L1ScalesProducers/data/L1MuTriggerScalesConfig.cff"
  include "L1TriggerConfig/L1ScalesProducers/data/L1MuGMTScalesConfig.cff"
  include "L1TriggerConfig/GMTConfigProducers/data/L1MuGMTParametersConfig.cff"

  // GMT Emulator
  include "L1Trigger/GlobalMuonTrigger/data/gmtDigis.cff"
  replace gmtDigis.DTCandidates = source:DT
  replace gmtDigis.CSCCandidates = source:CSC
  replace gmtDigis.RPCbCandidates = source:RPCb
  replace gmtDigis.RPCfCandidates = source:RPCf
  replace gmtDigis.Debug = 9
  replace gmtDigis.BX_min = -1
  replace gmtDigis.BX_max = 1
  replace gmtDigis.BX_min_readout = -1
  replace gmtDigis.BX_max_readout = 1

  include "L1Trigger/GlobalTrigger/data/gtDigis.cfi"
  replace gtDigis.inputMask = { 1, 0}

  include "EventFilter/L1GlobalTriggerRawToDigi/data/l1GtPack.cfi"
    replace l1GtPack.ActiveBoardsMask =0x0100
  include "EventFilter/L1GlobalTriggerRawToDigi/data/l1GtUnpack.cfi"
  
  module dump1 = L1MuGMTDump { untracked InputTag GMTInputTag = gmtDigis }
  module dump2 = L1MuGMTDump { untracked InputTag GMTInputTag = l1GtUnpack }

  path p = { gmtDigis, gtDigis, l1GtPack, l1GtUnpack, dump1, dump2 } 

  module out = PoolOutputModule { 
    untracked string fileName = "gmtPackUnpack.root" 
    untracked vstring outputCommands = {
      "keep *"
    }

  }
  endpath outpath = { out }

}
